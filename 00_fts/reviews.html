<!--
    리뷰수집 결과 페이지
    node server에서 / 경로로 접근했을 때 현재 페이지로 접속하고 입력창에 productId를 입력 후 제출하면 리뷰 수집 결과가 동적으로 추가됨
    front server 추가 전
    작성자명 : 장다은
    작성일자 : 240501
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Reviews</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div>
        <form id="productForm">
            Product ID: <input type="text" name="productId" id="productId"/>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div id="reviewSection">
        <h2 id="reviewsHeader">상품리뷰섹션</h2>
        <ul id="reviewsList">
            <!-- 리뷰가 여기에 ... 짜잔^^v -->
        </ul>
    </div>

    <script>
    document.getElementById('productForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const productId = document.getElementById('productId').value;
        if (productId) {
            document.getElementById('reviewsHeader').textContent = `${productId}의 리뷰입니다.`;
            axios.get(`/submit-and-fetch-reviews?productId=${productId}`)
                .then(response => {
                    const reviewsList = document.getElementById('reviewsList');
                    reviewsList.innerHTML = ''; // 이전리뷰 초기화
                    if (response.data.reviews && response.data.reviews.length > 0) {
                        response.data.reviews.forEach(review => {
                            const li = document.createElement('li');
                            li.innerHTML = `
                                <div>Rank: ${review.rank} | Date: ${review.date}</div>
                                <p>${review.contents}</p>
                            `;
                            reviewsList.appendChild(li);
                        });
                    } else {
                        reviewsList.innerHTML = '<li>No reviews found.</li>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching reviews:', error);
                    reviewsList.innerHTML = '<li>Error loading reviews.</li>';
                });
        }
    });
    </script>
</body>
</html>
