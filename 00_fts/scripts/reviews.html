<!--
    리뷰수집 결과 페이지
    node server에서 / 경로로 접근했을 때 현재 페이지로 접속하고 입력창에 productId를 입력 후 제출하면 리뷰 수집 결과가 동적으로 추가됨
    productId 입력 후 로딩메세지 추가
    front server 추가완료 : apache2 포트번호 8050
    li 출력할때 옆에 점 삭제 완료
    작성자명 : 장다은
    작성일자 : 240501
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Reviews</title>
</head>
<body>
    <div>
        <form id="productForm">
            Product ID: <input type="text" id="productId" name="productId"/>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div>
        <h2>상품상세정보섹션</h2>
        <div style="border:1px; width: 50%; float: left; height: 250px;"><h3>상품이미지는 여기에</h3>상품이미지는 여기에</div>
        <div style="border:1px; width: 50%; float: right; height: 250px; "><h3>상품판매처는 여기에</h3>상품판매처는 여기에</div>
    </div>
    <div id="reviewSection">
        <h2 id="reviewsHeader">상품리뷰섹션</h2>
        <div id="statusMessage"></div>
        <ul id="reviewsList" style="list-style: none;">
            <!-- 리뷰 내용이 여기에... 짜잔^^v -->
        </ul>
    </div>

    <script>
    document.getElementById('productForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const productId = document.getElementById('productId').value;
        if (productId) {
            // 상품 리뷰 섹션 제목 즉시 업데이트
            document.getElementById('reviewsHeader').textContent = `${productId}의 리뷰입니다.`;
            
            // 상태 메시지 설정
            const statusMessage = document.getElementById('statusMessage');
            const reviewsList = document.getElementById('reviewsList');
            reviewsList.innerHTML = ''; // 이전 리뷰 내용 클리어
            statusMessage.textContent = "리뷰를 수집하고 있습니다..."; 

            fetch(`http://192.168.1.162:3000/reviews/${productId}`)
                .then(response => response.json())
                .then(data => {
                    statusMessage.textContent = ""; // 상태 메시지 초기화 : 이전 리뷰 안보이기
                    if (data.reviews && data.reviews.length > 0) {
                        data.reviews.forEach(review => {
                            const li = document.createElement('li');
                            li.innerHTML = `<div style="color:gray">⭐<span style="color:black"> ${review.rank} |</span> ${review.date}</div><p>${review.contents}</p>`;
                            reviewsList.appendChild(li);
                        });
                    } else {
                        statusMessage.textContent = data.message; // 오류 메시지 또는 '리뷰 검색 결과가 없습니다.' 메시지 표시
                    }
                })
                .catch(error => {
                    console.error('Error fetching reviews:', error);
                    statusMessage.textContent = "리뷰 로딩 중 에러 발생.";
                });
        }
    });
    </script>
</body>
</html>
